services:
  # Remove the app and nginx services since we don't need them for tests
  app: !reset null
  nginx: !reset null

  app-test:
    image: ghcr.io/mampf-hd/mampftest:image
    # only used when Cypress is running tests in CI, NOT for unit tests. For unit
    # tests, we overwrite the entrypoint to the empty string.
    entrypoint: ["CI=true RUBY_DEBUG_ENABLE=false DISABLE_VITE_IN_CI=true ./init-and-run.sh"]
    volumes:
      # (In addition to other volumes)
      # Anonymous volume for the uploads subfolder to mitigate permission errors
      # Ã  la: Permission denied @ dir_s_mkdir - /workspaces/mampf/public/uploads
      # We don't mount the entire public/ folder to preserve precompiled assets
      - "/workspaces/mampf/public/uploads/"

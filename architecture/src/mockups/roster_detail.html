<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Roster Maintenance — Detail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  </head>
  <body class="bg-light">
  <div class="container my-4">
      <nav aria-label="breadcrumb" class="mb-2">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item"><a href="./roster_overview.html">Roster overview</a></li>
          <li class="breadcrumb-item active" aria-current="page" id="crumb">Tutorial</li>
        </ol>
      </nav>

      <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h4 mb-0" id="title">Tutorial — Detail</h1>
        <div class="small text-muted" id="cap">Capacity: —</div>
      </div>

      <div class="row g-3">
  <div class="col-12">
          <div class="card mb-3">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="h6 mb-0">Participants</h2>
                <div class="d-flex align-items-center gap-3">
                  <div class="small text-muted" id="count">—</div>
                  <button class="btn btn-sm btn-primary" id="addBtn">Add student</button>
                </div>
              </div>
              <div class="row g-2 mb-2">
                <div class="col-12 col-md-6">
                  <div class="input-group input-group-sm">
                    <span class="input-group-text">Search</span>
                    <input type="search" class="form-control" id="psearch" placeholder="Name or matric…" />
                  </div>
                </div>
                <div class="col-12 col-md-6 text-md-end">
                  <small class="text-muted" id="pmeta">—</small>
                </div>
              </div>
              <div class="table-responsive">
                <table class="table table-sm align-middle">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Name</th>
                      <th scope="col" class="text-end">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="tbody"></tbody>
                </table>
              </div>
            </div>
          </div>

          
        </div>
      </div>
    </div>

    <script>
      function makePeople(n, start) {
        const first = ['Alice','Bela','Chun','Daria','Eren','Farah','Gao','Hana','Ilya','Jan','Kim','Luca','Mia','Noah','Omar','Pia','Quinn','Ravi']
        const last = ['Anders','Bauer','Chen','Dorn','Er','Fischer','Gu','Hansen','Ivanov','Jansen','Klein','Lang','Meier','Neumann','Öztürk','Pohl','Quast','Reuter']
        const arr = []
        for (let i = 0; i < n; i++) {
          const name = `${first[i % first.length]} ${last[i % last.length]}`
          const matric = String(start + i)
          arr.push([name, matric])
        }
        return arr
      }

      const allGroups = {}
      ;['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O'].forEach((id, idx) => {
        allGroups[id] = {
          id,
          title: `Tutorial ${id}`,
          capacity: 25,
          people: makePeople(10 + ((idx + 3) % 8), 100001 + idx * 100)
        }
      })

      // candidates are managed on the overview page

      function byId(id) { return document.getElementById(id) }
      function qs(name) { return new URLSearchParams(location.search).get(name) }

      function renderHeader(group) {
        byId('crumb').textContent = group.title
        byId('title').textContent = `${group.title} — Detail`
        byId('cap').textContent = `Capacity: ${group.people.length}/${group.capacity}`
      }

      function renderTable(group) {
        const tb = byId('tbody')
        tb.innerHTML = ''
        const q = byId('psearch').value.trim().toLowerCase()
        const rows = (group.people || [])
          .map((p, idx) => ({ p, idx }))
          .filter(r => !q || r.p[0].toLowerCase().includes(q) || r.p[1].toLowerCase().includes(q))
        rows.forEach(({p, idx}, i) => {
          const tr = document.createElement('tr')
          tr.innerHTML = `
            <th scope="row">${i + 1}</th>
            <td>${p[0]}</td>
            <td class="text-end">
              <div class="btn-group btn-group-sm" role="group">
                <button class="btn btn-outline-danger" data-action="remove" data-i="${idx}">Remove</button>
                <div class="btn-group" role="group">
                  <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">Move</button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    ${Object.keys(allGroups).filter(g => g !== current.id).map(g => `<li><a class="dropdown-item" href="#" data-action="move" data-i="${idx}" data-to="${g}">to ${g}</a></li>`).join('')}
                  </ul>
                </div>
              </div>
            </td>
          `
          tb.appendChild(tr)
        })
        byId('count').textContent = `${group.people.length} participants`
        byId('pmeta').textContent = `${rows.length} shown`
        tb.querySelectorAll('[data-action="remove"]').forEach(btn => btn.addEventListener('click', onRemove))
        tb.querySelectorAll('[data-action="move"]').forEach(a => a.addEventListener('click', onMove))
      }

      function onRemove(ev) {
        const i = Number(ev.currentTarget.getAttribute('data-i'))
        current.people.splice(i, 1)
        render()
      }

      function onMove(ev) {
        ev.preventDefault()
        const i = Number(ev.currentTarget.getAttribute('data-i'))
        const to = ev.currentTarget.getAttribute('data-to')
        const target = allGroups[to]
        if (target.people.length >= target.capacity) { alert(`Cannot move: ${target.title} is full`); return }
        const person = current.people.splice(i, 1)[0]
        target.people.push(person)
        render()
      }

      function render() {
        renderHeader(current)
        renderTable(current)
      }

      const ADD_POOL = [
        ['Jan Jansen','100201'], ['Kim Klein','100202'], ['Luca Lang','100203'],
        ['Mia Meier','100204'], ['Noah Neumann','100205'], ['Omar Öz','100206']
      ]

  const gid = (qs('g') || 'A').toUpperCase()
  const current = allGroups[gid] || allGroups.A
  if (!current.people || current.people.length === 0) current.people = makePeople(12, 200001)

      function openAddModal() {
        byId('addSearch').value = ''
        renderAddResults()
        const modal = new bootstrap.Modal(byId('addModal'))
        byId('addAlert').classList.add('d-none')
        modal.show()
      }

      function renderAddResults() {
        const q = byId('addSearch').value.trim().toLowerCase()
        const list = byId('addResults')
        list.innerHTML = ''
        ADD_POOL.forEach((p, idx) => {
          const hay = `${p[0]} ${p[1]}`.toLowerCase()
          if (q && !hay.includes(q)) return
          const li = document.createElement('li')
          li.className = 'list-group-item d-flex justify-content-between align-items-center'
          li.innerHTML = `
            <div>
              <div class="fw-semibold">${p[0]}</div>
              <div class="text-muted small">${p[1]}</div>
            </div>
            <button class="btn btn-sm btn-outline-primary" data-action="add" data-i="${idx}">Add</button>
          `
          list.appendChild(li)
        })
        list.querySelectorAll('[data-action="add"]').forEach(btn => btn.addEventListener('click', () => addStudent(Number(btn.getAttribute('data-i')))))
      }

      function addStudent(idx) {
        if (current.people.length >= current.capacity) {
          const el = byId('addAlert')
          el.textContent = 'Cannot add: group is full'
          el.classList.remove('d-none')
          return
        }
        const [name, matric] = ADD_POOL[idx]
        if (current.people.some(p => p[1] === matric)) {
          const el = byId('addAlert')
          el.textContent = 'Already in this group'
          el.classList.remove('d-none')
          return
        }
        current.people.push([name, matric])
        byId('addAlert').classList.add('d-none')
        const modalEl = byId('addModal')
        const m = bootstrap.Modal.getInstance(modalEl)
        if (m) m.hide()
        render()
      }

  byId('addBtn').addEventListener('click', openAddModal)
  byId('psearch').addEventListener('input', render)
    const addSearchEl = byId('addSearch')
    if (addSearchEl) addSearchEl.addEventListener('input', renderAddResults)

      render()
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add student</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="input-group input-group-sm mb-2">
              <span class="input-group-text">Search</span>
              <input type="search" class="form-control" id="addSearch" placeholder="Name or matric…" />
            </div>
            <div id="addAlert" class="alert alert-danger py-1 px-2 d-none" role="alert"></div>
            <ul id="addResults" class="list-group list-group-flush"></ul>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>

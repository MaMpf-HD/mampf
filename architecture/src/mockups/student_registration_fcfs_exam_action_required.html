<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Student Registration – Analysis II Exam (Action required)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body class="bg-light">
    <div class="container my-4">
      <nav aria-label="breadcrumb" class="mb-2">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item"><a href="./student_registration_index_tabs.html">Registrations</a></li>
          <li class="breadcrumb-item active" aria-current="page">Analysis II (Exam)</li>
        </ol>
      </nav>

      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <h1 class="h4 mb-1">Analysis II – Exam Registration <span class="badge text-bg-warning">Action required</span></h1>
          <div class="text-muted small">SS 2025 · Exam code: AN2-S25</div>
        </div>
        <div class="text-end">
          <div class="text-muted small mb-1">Campaign: Exam seat registration</div>
          <span class="badge text-bg-danger">Closes: Oct 02, 10:00</span>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-12 col-lg-4">
          <div class="card h-100">
            <div class="card-body">
              <h2 class="h5">Your Eligibility</h2>
              <p class="mb-2 small text-muted">Status: <span class="badge rounded-pill text-bg-success">Eligible</span></p>
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <div class="fw-semibold">Exam eligibility</div>
                    <small class="text-muted">Lecture prerequisites satisfied</small>
                  </div>
                  <span class="badge rounded-pill text-bg-success">Passed</span>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-8">
          <div class="card h-100">
            <div class="card-body">
              <h2 class="h5">Complete requirements</h2>
              <div class="row g-2 mb-2">
                <div class="col-12 col-md-8 small text-muted">
                  Provide the required information to enable registration.
                </div>
                <div class="col-12 col-md-4 d-flex justify-content-md-end">
                  <div class="small" id="saveStatus"></div>
                </div>
              </div>
              <form id="reqForm" class="mb-3">
                <div class="row g-3">
                  <div class="col-12 col-md-6">
                    <label for="matric" class="form-label">Matriculation number</label>
                    <input type="text" class="form-control" id="matric" placeholder="e.g., 1234567" />
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="idtype" class="form-label">ID type</label>
                    <select id="idtype" class="form-select">
                      <option value="">Select…</option>
                      <option value="passport">Passport</option>
                      <option value="national_id">National ID</option>
                      <option value="student_card">Student Card</option>
                    </select>
                  </div>
                  <div class="col-12">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="honesty" />
                      <label class="form-check-label" for="honesty">I confirm that I have read and accept the exam rules</label>
                    </div>
                  </div>
                </div>
                <div class="d-flex justify-content-end gap-2 mt-3">
                  <button type="button" class="btn btn-outline-primary btn-sm" id="saveReqBtn" disabled>Save requirements</button>
                </div>
              </form>

              <h2 class="h6">Your Registration</h2>
              <div class="row g-2 mb-2">
                <div class="col-12 col-md-7 small text-muted">
                  Date & time: Thu, Oct 02, 10:00–12:00 · Location: INF 205, HS2
                </div>
              </div>
              <div id="statusPanel" class="mb-3">
                <span class="badge rounded-pill text-bg-secondary" id="regState">Not registered</span>
              </div>
              <div class="d-flex gap-2">
                <button type="button" class="btn btn-primary btn-sm" id="registerBtn" disabled>Register now</button>
                <button type="button" class="btn btn-outline-danger btn-sm d-none" id="withdrawBtn">Withdraw</button>
              </div>
              <div id="saveAlert" class="alert alert-success py-1 px-2 d-none mt-3" role="alert">Updated</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card mt-3">
        <div class="card-body">
          <h2 class="h5">Details</h2>
          <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">Mode</div>
                <small class="text-muted">First-come, first-served</small>
              </div>
              <span class="badge rounded-pill text-bg-secondary">FCFS</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">Seat capacity</div>
                <small class="text-muted">Hall-limited seats (example)</small>
              </div>
              <span class="badge rounded-pill text-bg-info" id="capacityInfo">—</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
      const REQ_KEY = 'fcfs:EXAM:AN2-S25:req'
      const REQ_TS = 'fcfs:EXAM:AN2-S25:req_ts'
      const REG_KEY = 'fcfs:EXAM:AN2-S25:reg'
      const REG_TS = 'fcfs:EXAM:AN2-S25:reg_ts'

      const matric = document.getElementById('matric')
      const idtype = document.getElementById('idtype')
      const honesty = document.getElementById('honesty')
      const saveReqBtn = document.getElementById('saveReqBtn')
      const saveStatus = document.getElementById('saveStatus')
      const saveAlert = document.getElementById('saveAlert')

      const registerBtn = document.getElementById('registerBtn')
      const withdrawBtn = document.getElementById('withdrawBtn')
      const regState = document.getElementById('regState')
      const capacityInfo = document.getElementById('capacityInfo')

      let isSaving = false
      
      function reqValid() {
        return matric.value.trim().length >= 5 && idtype.value && honesty.checked
      }

      function updateReqUI() {
        saveReqBtn.disabled = !reqValid() || isSaving
      }

      function setSaving(text) {
        saveStatus.innerHTML = text ? `<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>${text}` : ''
        saveStatus.className = text ? 'small text-muted' : 'small'
      }

      function setSaved(tsKey) {
        const ts = parseInt(localStorage.getItem(tsKey) || '0', 10)
        if (!ts) { saveStatus.textContent = ''; return }
        const d = new Date(ts)
        const hh = String(d.getHours()).padStart(2, '0')
        const mm = String(d.getMinutes()).padStart(2, '0')
        saveStatus.textContent = `Saved at ${hh}:${mm}`
        saveStatus.className = 'small text-success'
      }

      function saveRequirements() {
        if (!reqValid() || isSaving) return
        isSaving = true
        setSaving('Saving…')
        setTimeout(() => {
          const payload = { matric: matric.value.trim(), idtype: idtype.value, honesty: !!honesty.checked }
          localStorage.setItem(REQ_KEY, JSON.stringify(payload))
          localStorage.setItem(REQ_TS, String(Date.now()))
          isSaving = false
          saveAlert.classList.remove('d-none')
          setTimeout(() => saveAlert.classList.add('d-none'), 1500)
          setSaved(REQ_TS)
          updateReqUI()
          maybeEnableRegister()
        }, 700)
      }

      function updateRegUI(registered) {
        regState.textContent = registered ? 'Registered' : 'Not registered'
        regState.className = registered ? 'badge rounded-pill text-bg-success' : 'badge rounded-pill text-bg-secondary'
        registerBtn.classList.toggle('d-none', registered)
        withdrawBtn.classList.toggle('d-none', !registered)
        const base = 120
        const filled = base + (registered ? 1 : 0)
        capacityInfo.textContent = `${filled}/300 filled`
      }

      function maybeEnableRegister() {
        const req = localStorage.getItem(REQ_KEY)
        const ready = !!req
        registerBtn.disabled = !ready
      }

      function saveRegistration(registered) {
        if (isSaving) return
        isSaving = true
        setSaving('Saving…')
        setTimeout(() => {
          localStorage.setItem(REG_KEY, registered ? '1' : '0')
          localStorage.setItem(REG_TS, String(Date.now()))
          isSaving = false
          saveAlert.classList.remove('d-none')
          setTimeout(() => saveAlert.classList.add('d-none'), 1500)
          setSaved(REG_TS)
          updateRegUI(registered)
        }, 700)
      }

      saveReqBtn.addEventListener('click', saveRequirements)
      matric.addEventListener('input', updateReqUI)
      idtype.addEventListener('change', updateReqUI)
      honesty.addEventListener('change', updateReqUI)

      registerBtn.addEventListener('click', () => saveRegistration(true))
      withdrawBtn.addEventListener('click', () => saveRegistration(false))

      ;(function init() {
        try {
          const req = JSON.parse(localStorage.getItem(REQ_KEY) || 'null')
          if (req) {
            matric.value = req.matric || ''
            idtype.value = req.idtype || ''
            honesty.checked = !!req.honesty
            setSaved(REQ_TS)
          }
        } catch(_) {}
        const registered = localStorage.getItem(REG_KEY) === '1'
        updateReqUI()
        maybeEnableRegister()
        updateRegUI(registered)
      })()
    </script>
  </body>
</html>

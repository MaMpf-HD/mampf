<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Student Registration – Seminar Enrollment (FCFS)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body class="bg-light">
    <div class="container my-4">
      <nav aria-label="breadcrumb" class="mb-2">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item"><a href="./student_registration_index_tabs.html">Registrations</a></li>
          <li class="breadcrumb-item active" aria-current="page">Formal Math (Seminar)</li>
        </ol>
      </nav>

      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <h1 class="h4 mb-1">Formal Math (Seminar) – Seminar Enrollment <span class="badge text-bg-primary">Open</span></h1>
          <div class="text-muted small">WS 2025/26 · Course code: FM-Sem</div>
        </div>
        <div class="text-end">
          <div class="text-muted small mb-1">Campaign: Main registration</div>
          <span class="badge text-bg-danger">Closes: Oct 19, 12:00</span>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-12 col-lg-4">
          <div class="card h-100">
            <div class="card-body">
              <h2 class="h5">Your Eligibility</h2>
              <p class="mb-2 small text-muted">Status: <span class="badge rounded-pill text-bg-success">Eligible</span></p>
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <div class="fw-semibold">Institutional email</div>
                    <small class="text-muted">@uni.edu</small>
                  </div>
                  <span class="badge rounded-pill text-bg-success">Passed</span>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-8">
          <div class="card h-100">
            <div class="card-body">
              <h2 class="h5">Your Registration</h2>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div class="small text-muted">Seats remaining: <span id="seatsRemaining">7</span></div>
                <div class="small" id="saveStatus"></div>
              </div>
              <div id="statusPanel" class="mb-3">
                <span class="badge rounded-pill text-bg-secondary" id="regState">Not registered</span>
              </div>
              <div class="d-flex gap-2">
                <button type="button" class="btn btn-primary btn-sm" id="registerBtn">Register now</button>
                <button type="button" class="btn btn-outline-danger btn-sm d-none" id="withdrawBtn">Withdraw</button>
              </div>
              <div id="saveAlert" class="alert alert-success py-1 px-2 d-none mt-3" role="alert">Registration updated</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card mt-3">
        <div class="card-body">
          <h2 class="h5">Details</h2>
          <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">Mode</div>
                <small class="text-muted">First-come, first-served</small>
              </div>
              <span class="badge rounded-pill text-bg-secondary">FCFS</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">Capacity</div>
                <small class="text-muted">25 seats</small>
              </div>
              <span class="badge rounded-pill text-bg-info" id="capacityInfo">18/25 filled</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
      const KEY = 'fcfs:FM-Sem:registered'
      const STATE_KEY = 'fcfs:FM-Sem:ts'
      const registerBtn = document.getElementById('registerBtn')
      const withdrawBtn = document.getElementById('withdrawBtn')
      const regState = document.getElementById('regState')
      const saveStatus = document.getElementById('saveStatus')
      const saveAlert = document.getElementById('saveAlert')
      const seatsRemaining = document.getElementById('seatsRemaining')
      const capacityInfo = document.getElementById('capacityInfo')
      let isSaving = false

      function updateUI(registered) {
        regState.textContent = registered ? 'Registered' : 'Not registered'
        regState.className = registered ? 'badge rounded-pill text-bg-success' : 'badge rounded-pill text-bg-secondary'
        registerBtn.classList.toggle('d-none', registered)
        withdrawBtn.classList.toggle('d-none', !registered)
        // demo seat counters
        const baseFilled = 18
        const filled = baseFilled + (registered ? 1 : 0)
        const remaining = 25 - filled
        seatsRemaining.textContent = String(Math.max(0, remaining))
        capacityInfo.textContent = `${filled}/25 filled`
      }

      function updateStatusSaving() {
        saveStatus.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>Saving…'
        saveStatus.className = 'small text-muted'
      }
      function updateStatusSaved() {
        const ts = parseInt(localStorage.getItem(STATE_KEY) || '0', 10)
        if (!ts) { saveStatus.textContent = ''; return }
        const d = new Date(ts)
        const hh = String(d.getHours()).padStart(2, '0')
        const mm = String(d.getMinutes()).padStart(2, '0')
        saveStatus.textContent = `Saved at ${hh}:${mm}`
        saveStatus.className = 'small text-success'
      }

      function setDisabled(disabled) {
        registerBtn.disabled = disabled
        withdrawBtn.disabled = disabled
      }

      function save(registered) {
        if (isSaving) return
        isSaving = true
        updateStatusSaving()
        setDisabled(true)
        setTimeout(() => {
          localStorage.setItem(KEY, registered ? '1' : '0')
          localStorage.setItem(STATE_KEY, String(Date.now()))
          isSaving = false
          saveAlert.classList.remove('d-none')
          setTimeout(() => saveAlert.classList.add('d-none'), 1500)
          updateStatusSaved()
          setDisabled(false)
          updateUI(registered)
        }, 700)
      }

      registerBtn.addEventListener('click', () => save(true))
      withdrawBtn.addEventListener('click', () => save(false))

      ;(function init() {
        const registered = localStorage.getItem(KEY) === '1'
        updateUI(registered)
        updateStatusSaved()
      })()
    </script>
  </body>
</html>

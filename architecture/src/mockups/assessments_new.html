<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Assessment — Linear Algebra I</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    .form-check-input:checked ~ .mode-description {
      font-weight: 500;
    }
    #taskFields {
      display: none;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">MaMpf</a>
      <span class="navbar-text text-white-50">Teacher/Editor View</span>
    </div>
  </nav>

  <div class="container mt-4 mb-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="#">Linear Algebra I</a></li>
        <li class="breadcrumb-item"><a href="assessments_index.html">Assessments</a></li>
        <li class="breadcrumb-item active" aria-current="page">Create</li>
      </ol>
    </nav>

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="h2 mb-1">Create Assessment</h1>
        <p class="text-muted mb-0">Linear Algebra I — WS 2024/25</p>
      </div>
      <a href="assessments_index.html" class="btn btn-outline-secondary">
        <i class="bi bi-x-lg me-2"></i>Cancel
      </a>
    </div>

    <!-- Form -->
    <form>
      <div class="card">
        <div class="card-header bg-light">
          <h5 class="mb-0">Basic Information</h5>
        </div>
        <div class="card-body">
          <!-- Title -->
          <div class="mb-3">
            <label for="title" class="form-label">
              Title <span class="text-danger">*</span>
            </label>
            <input type="text" class="form-control" id="title" name="title" 
                   placeholder="e.g., Homework 1, Midterm Exam, Final Exam" required>
            <div class="form-text">
              A descriptive name that will be shown to students and in reports.
            </div>
          </div>

          <!-- Assessable Type & Assessable ID -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="assessableType" class="form-label">
                Type <span class="text-danger">*</span>
              </label>
              <select class="form-select" id="assessableType" name="assessable_type" required>
                <option value="">Select type...</option>
                <option value="Assignment" selected>Assignment (Homework)</option>
                <option value="Exam">Exam</option>
                <option value="Talk">Talk (Seminar Presentation)</option>
              </select>
              <div class="form-text">
                What kind of work is being assessed?
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="assessableId" class="form-label">
                Link to Existing Record
              </label>
              <select class="form-select" id="assessableId" name="assessable_id">
                <option value="">Create standalone assessment</option>
                <option value="1">Assignment: Homework 1</option>
                <option value="2">Assignment: Homework 2</option>
                <option value="3">Exam: Midterm</option>
              </select>
              <div class="form-text">
                Optional: Link to an existing assignment/exam/talk record.
              </div>
            </div>
          </div>

          <!-- Assessment Mode (Pointbook vs Gradebook) -->
          <div class="mb-3">
            <label class="form-label d-block mb-2">
              Assessment Mode <span class="text-danger">*</span>
            </label>
            
            <div class="card mb-2">
              <div class="card-body py-3">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="requires_points" 
                         id="pointbookMode" value="true" checked>
                  <label class="form-check-label" for="pointbookMode">
                    <strong>Pointbook Mode</strong> — Track points per task
                    <div class="mode-description text-muted small mt-1">
                      Use this for homework assignments and exams where you want to grade individual problems/questions 
                      and aggregate points automatically. You'll define tasks below.
                    </div>
                  </label>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-body py-3">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="requires_points" 
                         id="gradebookMode" value="false">
                  <label class="form-check-label" for="gradebookMode">
                    <strong>Gradebook Mode</strong> — Record final grade only
                    <div class="mode-description text-muted small mt-1">
                      Use this for seminar talks or other work where you assign a single final grade 
                      without breaking it down into sub-components.
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Requires Submission -->
          <div class="mb-3">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="requiresSubmission" 
                     name="requires_submission" checked>
              <label class="form-check-label" for="requiresSubmission">
                <strong>Requires file submission</strong>
                <div class="text-muted small mt-1">
                  Students must upload files (PDFs, code, etc.) for this assessment. 
                  Uncheck for in-person exams or oral presentations.
                </div>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Schedule & Visibility -->
      <div class="card mt-3">
        <div class="card-header bg-light">
          <h5 class="mb-0">Schedule & Visibility</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="visibleFrom" class="form-label">
                Visible from
              </label>
              <input type="datetime-local" class="form-control" id="visibleFrom" name="visible_from">
              <div class="form-text">
                When should students see this assessment? Leave blank for immediate visibility.
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label for="dueAt" class="form-label">
                Due date
              </label>
              <input type="datetime-local" class="form-control" id="dueAt" name="due_at">
              <div class="form-text">
                Deadline for submissions (if applicable).
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Points Configuration (Pointbook Mode Only) -->
      <div class="card mt-3" id="taskFields">
        <div class="card-header bg-light">
          <h5 class="mb-0">Tasks & Points Configuration</h5>
        </div>
        <div class="card-body">
          <div class="alert alert-info d-flex align-items-start mb-3">
            <i class="bi bi-info-circle me-2 mt-1"></i>
            <div>
              <strong>Note:</strong> You can configure the maximum total points here, or leave it blank 
              to auto-calculate from the sum of task max_points. Tasks can be added after creating the assessment.
            </div>
          </div>

          <div class="mb-3">
            <label for="totalPoints" class="form-label">
              Total Maximum Points
            </label>
            <input type="number" class="form-control" id="totalPoints" name="total_points" 
                   placeholder="Leave blank to auto-calculate" min="0" step="0.5">
            <div class="form-text">
              The maximum achievable points for this assessment. If left blank, it will be computed 
              as the sum of all task max_points.
            </div>
          </div>

          <div class="border-top pt-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <label class="form-label mb-0">Tasks (Problems/Questions)</label>
              <button type="button" class="btn btn-sm btn-outline-primary" id="addTaskBtn">
                <i class="bi bi-plus-lg me-1"></i>Add Task
              </button>
            </div>
            <div class="form-text mb-3">
              You can add tasks now or configure them later on the assessment detail page.
            </div>

            <!-- Task Entry Area (Initially Empty) -->
            <div id="tasksContainer">
              <div class="alert alert-light text-center py-4">
                <i class="bi bi-list-task text-muted" style="font-size: 2rem;"></i>
                <div class="text-muted mt-2">No tasks added yet. Click "Add Task" to define problems/questions.</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="d-flex justify-content-between mt-4">
        <a href="assessments_index.html" class="btn btn-outline-secondary">
          <i class="bi bi-x-lg me-2"></i>Cancel
        </a>
        <div>
          <button type="submit" name="status" value="draft" class="btn btn-secondary me-2">
            <i class="bi bi-floppy me-2"></i>Save as Draft
          </button>
          <button type="submit" name="status" value="open" class="btn btn-primary">
            <i class="bi bi-check-lg me-2"></i>Create & Open for Students
          </button>
        </div>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Toggle task fields based on assessment mode
    const pointbookRadio = document.getElementById('pointbookMode');
    const gradebookRadio = document.getElementById('gradebookMode');
    const taskFields = document.getElementById('taskFields');

    function toggleTaskFields() {
      if (pointbookRadio.checked) {
        taskFields.style.display = 'block';
      } else {
        taskFields.style.display = 'none';
      }
    }

    pointbookRadio.addEventListener('change', toggleTaskFields);
    gradebookRadio.addEventListener('change', toggleTaskFields);

    // Initialize on page load
    toggleTaskFields();

    // Add Task functionality (simple demo)
    let taskCount = 0;
    const addTaskBtn = document.getElementById('addTaskBtn');
    const tasksContainer = document.getElementById('tasksContainer');

    addTaskBtn.addEventListener('click', function() {
      // Remove empty state message if present
      if (taskCount === 0) {
        tasksContainer.innerHTML = '';
      }

      taskCount++;
      const taskHtml = `
        <div class="card mb-2" data-task-id="${taskCount}">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h6 class="mb-0">Task ${taskCount}</h6>
              <button type="button" class="btn btn-sm btn-outline-danger remove-task-btn">
                <i class="bi bi-trash"></i>
              </button>
            </div>
            <div class="row">
              <div class="col-md-8 mb-2">
                <label class="form-label small">Title</label>
                <input type="text" class="form-control form-control-sm" 
                       name="tasks[${taskCount}][title]" placeholder="e.g., Problem 1" required>
              </div>
              <div class="col-md-4 mb-2">
                <label class="form-label small">Max Points</label>
                <input type="number" class="form-control form-control-sm" 
                       name="tasks[${taskCount}][max_points]" min="0" step="0.5" required>
              </div>
              <div class="col-12">
                <label class="form-label small">Description (optional)</label>
                <textarea class="form-control form-control-sm" 
                          name="tasks[${taskCount}][description]" rows="2"></textarea>
              </div>
            </div>
          </div>
        </div>
      `;
      tasksContainer.insertAdjacentHTML('beforeend', taskHtml);

      // Attach remove handler to the new button
      const newCard = tasksContainer.lastElementChild;
      newCard.querySelector('.remove-task-btn').addEventListener('click', function() {
        newCard.remove();
        taskCount--;
        
        // Show empty state if no tasks remain
        if (taskCount === 0) {
          tasksContainer.innerHTML = `
            <div class="alert alert-light text-center py-4">
              <i class="bi bi-list-task text-muted" style="font-size: 2rem;"></i>
              <div class="text-muted mt-2">No tasks added yet. Click "Add Task" to define problems/questions.</div>
            </div>
          `;
        }
      });
    });
  </script>
</body>
</html>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Student Registration – Partial Differential Equations (FCFS Tutorials)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body class="bg-light">
    <div class="container my-4">
      <nav aria-label="breadcrumb" class="mb-2">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item"><a href="./student_registration_index_tabs.html">Registrations</a></li>
          <li class="breadcrumb-item active" aria-current="page">Partial Differential Equations</li>
        </ol>
      </nav>

      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <h1 class="h4 mb-1">Partial Differential Equations – Tutorial Registration <span class="badge text-bg-primary">Open</span></h1>
          <div class="text-muted small">WS 2025/26 · Course code: PDE</div>
        </div>
        <div class="text-end">
          <div class="text-muted small mb-1">Campaign: Main registration</div>
          <span class="badge text-bg-danger">Closes: Oct 22, 14:00</span>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-12 col-lg-4">
          <div class="card h-100">
            <div class="card-body">
              <h2 class="h5">Your Eligibility</h2>
              <p class="mb-2 small text-muted">Status: <span class="badge rounded-pill text-bg-success">Eligible</span></p>
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <div class="fw-semibold">Institutional email</div>
                    <small class="text-muted">@uni.edu</small>
                  </div>
                  <span class="badge rounded-pill text-bg-success">Passed</span>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-8">
          <div class="card h-100">
            <div class="card-body">
              <h2 class="h5">Select a tutorial</h2>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <input id="catalogSearch" type="search" class="form-control form-control-sm" placeholder="Filter by weekday, time, tutor, room" style="max-width: 22rem" />
                <div class="small" id="saveStatus"></div>
              </div>
              <div id="switchInfo" class="alert alert-info py-1 px-2 d-none" role="alert">
                Currently registered: <span id="currentTutorialName"></span>. Withdraw to switch to a different group.
              </div>
              <div class="table-responsive">
                <table class="table align-middle mb-2" id="tutorialsTable">
                  <thead>
                    <tr>
                      <th>Tutorial</th>
                      <th>Time</th>
                      <th>Seats</th>
                      <th>Status</th>
                      <th class="text-end">Action</th>
                    </tr>
                  </thead>
                  <tbody id="tutorialsBody"></tbody>
                </table>
              </div>
              <div id="saveAlert" class="alert alert-success py-1 px-2 d-none" role="alert">Registration updated</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card mt-3">
        <div class="card-body">
          <h2 class="h5">Details</h2>
          <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">Mode</div>
                <small class="text-muted">First-come, first-served</small>
              </div>
              <span class="badge rounded-pill text-bg-secondary">FCFS</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">Capacity</div>
                <small class="text-muted">Per-group seat limits</small>
              </div>
              <span class="badge rounded-pill text-bg-info" id="capacityInfo">—</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
      const KEY = 'fcfs:PDE:selected'
      const TS_KEY = 'fcfs:PDE:ts'
      const search = document.getElementById('catalogSearch')
      const body = document.getElementById('tutorialsBody')
      const saveStatus = document.getElementById('saveStatus')
      const saveAlert = document.getElementById('saveAlert')
  const capacityInfo = document.getElementById('capacityInfo')
  const switchInfo = document.getElementById('switchInfo')
  const currentTutorialName = document.getElementById('currentTutorialName')
      let isSaving = false

      const tutorials = [
        { id: 'A', title: 'Tutorial A', time: 'Mon 10:00', capacity: 30, filled: 30 },
        { id: 'B', title: 'Tutorial B', time: 'Tue 12:00', capacity: 25, filled: 22 },
        { id: 'C', title: 'Tutorial C', time: 'Wed 14:00', capacity: 25, filled: 25 },
        { id: 'D', title: 'Tutorial D', time: 'Thu 08:00', capacity: 30, filled: 18 },
        { id: 'E', title: 'Tutorial E', time: 'Fri 12:00', capacity: 30, filled: 29 }
      ]

      function currentSelection() {
        return localStorage.getItem(KEY)
      }

      function setStatusSaving() {
        saveStatus.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>Saving…'
        saveStatus.className = 'small text-muted'
      }

      function setStatusSaved() {
        const ts = parseInt(localStorage.getItem(TS_KEY) || '0', 10)
        if (!ts) { saveStatus.textContent = ''; saveStatus.className = 'small'; return }
        const d = new Date(ts)
        const hh = String(d.getHours()).padStart(2, '0')
        const mm = String(d.getMinutes()).padStart(2, '0')
        saveStatus.textContent = `Saved at ${hh}:${mm}`
        saveStatus.className = 'small text-success'
      }

      function render() {
        const q = (search.value || '').toLowerCase()
        body.innerHTML = ''
        const sel = currentSelection()
        if (sel) {
          const tSel = tutorials.find(t => t.id === sel)
          currentTutorialName.textContent = tSel ? `${tSel.title} (${tSel.time})` : sel
          switchInfo.classList.remove('d-none')
        } else {
          switchInfo.classList.add('d-none')
        }
        let total = 0
        let filledSum = 0
        tutorials.filter(t => (
          t.title.toLowerCase().includes(q) || t.time.toLowerCase().includes(q)
        )).forEach(t => {
          total += t.capacity
          filledSum += t.filled + (sel === t.id ? 1 : 0)
          const tr = document.createElement('tr')
          const name = document.createElement('td')
          name.textContent = t.title
          const time = document.createElement('td')
          time.textContent = t.time
          const seats = document.createElement('td')
          const newFilled = t.filled + (sel === t.id ? 1 : 0)
          seats.textContent = `${newFilled}/${t.capacity}`
          const status = document.createElement('td')
          const full = newFilled >= t.capacity
          const isSelected = sel === t.id
          const badge = document.createElement('span')
          badge.className = 'badge rounded-pill ' + (full ? 'text-bg-secondary' : (isSelected ? 'text-bg-success' : 'text-bg-info'))
          badge.textContent = full ? 'Full' : (isSelected ? 'Registered' : 'Available')
          status.appendChild(badge)
          const action = document.createElement('td')
          action.className = 'text-end'
          if (isSelected) {
            const btn = document.createElement('button')
            btn.type = 'button'
            btn.className = 'btn btn-sm btn-outline-danger'
            btn.textContent = 'Withdraw'
            btn.addEventListener('click', () => saveSelection(null))
            action.appendChild(btn)
          } else if (isSaving) {
            const hint = document.createElement('span')
            hint.className = 'text-muted small'
            hint.textContent = 'Saving…'
            action.appendChild(hint)
          } else if (sel && sel !== t.id) {
            const hint = document.createElement('span')
            hint.className = 'text-muted small'
            hint.textContent = 'Withdraw first'
            action.appendChild(hint)
          } else if (full) {
            const hint = document.createElement('span')
            hint.className = 'text-muted small'
            hint.textContent = 'No seats'
            action.appendChild(hint)
          } else {
            const btn = document.createElement('button')
            btn.type = 'button'
            btn.className = 'btn btn-sm btn-primary'
            btn.textContent = 'Register'
            btn.addEventListener('click', () => saveSelection(t.id))
            action.appendChild(btn)
          }
          tr.appendChild(name)
          tr.appendChild(time)
          tr.appendChild(seats)
          tr.appendChild(status)
          tr.appendChild(action)
          body.appendChild(tr)
        })
        capacityInfo.textContent = `${filledSum}/${total} filled across groups`
      }

      function saveSelection(newId) {
        if (isSaving) return
        isSaving = true
        setStatusSaving()
        render()
        setTimeout(() => {
          if (newId) {
            localStorage.setItem(KEY, newId)
          } else {
            localStorage.removeItem(KEY)
          }
          localStorage.setItem(TS_KEY, String(Date.now()))
          isSaving = false
          saveAlert.classList.remove('d-none')
          setTimeout(() => saveAlert.classList.add('d-none'), 1500)
          setStatusSaved()
          render()
        }, 800)
      }

      search.addEventListener('input', render)

      ;(function init() {
        setStatusSaved()
        render()
      })()
    </script>
  </body>
</html>

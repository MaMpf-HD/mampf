<div class="card mb-3">
  <div class="card-body">
    <%= form_with model: assignment, data: { turbo: true } do |f| %>
      <div class="row g-3">
        <div class="col-md-6">
          <%= f.label :title, t('basics.title'), class: "form-label" %>
          <%= f.text_field :title, class: 'form-control', placeholder: t('admin.assignment.title_placeholder') %>
          <div class="invalid-feedback" id="assignment-title-error"></div>
        </div>

        <div class="col-md-6">
          <%= f.label :deadline, t('basics.deadline'), class: "form-label" %>
          <div class="input-group td-picker"
               id="assignment-deadline-picker"
               data-controller="datetimepicker"
               data-td-target-input="nearest"
               data-td-target-toggle="nearest">
            <%= f.text_field :deadline,
                class: 'form-control td-input',
                data: { td_target: '#assignment-deadline-picker' },
                value: assignment.deadline&.strftime("%Y-%m-%d %H:%M"),
                autocomplete: 'off' %>
            <span class="input-group-text td-picker-button"
                  role="button"
                  data-td-target="#assignment-deadline-picker"
                  data-td-toggle="datetimepicker">
              <i class="bi bi-calendar-fill"></i>
            </span>
          </div>
          <div class="invalid-feedback td-error" id="assignment-deadline-error"
               data-td-invalid-date="<%= t('datetimepicker.invalid_date') %>"></div>
        </div>

        <div class="col-md-4">
          <%= f.label :medium_id, t('basics.medium'), class: "form-label" %>
          <%= f.select :medium_id,
                       options_for_select(Medium.where(teachable: assignment.lecture,
                                                      sort: 'Exercise')
                                                .map { |m| [m.local_title_for_viewers, m.id] },
                                          assignment.medium_id ),
                       { include_blank: t('basics.select') },
                       { id: "assignment_medium_id_#{assignment.id}",
                         class: 'selectize form-control' } %>
        </div>

        <div class="col-md-4">
          <%= f.label :accepted_file_type, t('submission.file_format'), class: "form-label" %>
          <%= f.select :accepted_file_type,
                       options_for_select(Assignment.accepted_file_types
                                                    .map { |t| [t,t] },
                                          assignment.accepted_file_type),
                       {},
                       { class: 'form-select' } %>
        </div>

        <div class="col-md-4">
          <%= f.label :deletion_date, t('assignment.deletion_date'), class: "form-label" %>
          <%= f.select :deletion_date,
                       Term.possible_deletion_dates_localized,
                       { selected: assignment.localized_deletion_date },
                       class: 'form-select' %>
          <div class="invalid-feedback" id="assignment-deletion-date-error"></div>
        </div>

        <div class="col-12">
          <div class="d-flex gap-2 justify-content-end">
            <% if assignment.persisted? %>
              <%= link_to cancel_editing_assignment_path(assignment),
                  class: "btn btn-secondary",
                  data: { turbo_method: :get } do %>
                <i class="bi bi-x-circle me-1"></i>
                <%= t('buttons.cancel') %>
              <% end %>
            <% else %>
              <%= link_to cancel_new_assignment_path(lecture: assignment.lecture_id),
                  class: "btn btn-secondary",
                  data: { turbo_method: :get } do %>
                <i class="bi bi-x-circle me-1"></i>
                <%= t('buttons.cancel') %>
              <% end %>
            <% end %>
            <%= f.button class: "btn btn-primary" do %>
              <i class="bi bi-check-circle me-1"></i>
              <%= t('buttons.save') %>
            <% end %>
          </div>
        </div>
      </div>

      <%= f.hidden_field :lecture_id, value: assignment.lecture.id %>
    <% end %>
  </div>
</div>

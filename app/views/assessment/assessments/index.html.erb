<%= turbo_frame_tag "assessment-assessments-frame" do %>
  <% I18n.with_locale(@lecture.locale_with_inheritance || I18n.default_locale) do %>
    <h3 class="lecture-pane-header">
      <%= @lecture.seminar? ? t('assessment.talks') : t('assessment.assignments') %>
    </h3>

    <% if @lecture.seminar? %>
      <div class="alert alert-info mb-3">
        <i class="bi bi-info-circle me-2"></i>
        <%= t('assessment.info.talks_created_in_roster') %>
      </div>
    <% else %>
      <div class="row mb-3">
        <div class="col-12 text-center">
          <%= link_to t('admin.assignment.new'),
                      new_assignment_path(params: { lecture_id: @lecture.id }),
                      class: 'btn btn-sm btn-primary',
                      id: 'newAssignmentButton',
                      data: { turbo_stream: true } %>
        </div>
      </div>

      <div id="assignment_form_container"></div>
    <% end %>

    <% if @assessables_with_assessment.any? %>
      <table class="table table-hover mb-4">
        <thead>
          <tr>
            <th><%= t('admin.assignment.title') %></th>
            <th><%= t('assessment.status.title') %></th>
            <th><%= t('assessment.due_at') %></th>
            <th><%= t('medium.singular') %></th>
            <th><%= t('admin.assignment.filetype') %></th>
            <th class="text-center"><%= t('assessment.tasks') %></th>
            <th><%= t('admin.assignment.deletion') %></th>
            <th></th>
          </tr>
        </thead>
        <tbody id="assessment-assessments-list">
          <% @assessables_with_assessment.each do |assessable| %>
            <%= render AssessmentListItemComponent.new(assessable: assessable, lecture: @lecture) %>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <table class="table table-hover mb-4">
        <thead>
          <tr>
            <th><%= t('admin.assignment.title') %></th>
            <th><%= t('assessment.status.title') %></th>
            <th><%= t('assessment.due_at') %></th>
            <th><%= t('medium.singular') %></th>
            <th><%= t('admin.assignment.filetype') %></th>
            <th class="text-center"><%= t('assessment.tasks') %></th>
            <th><%= t('admin.assignment.deletion') %></th>
          </tr>
        </thead>
        <tbody id="assessment-assessments-list">
        </tbody>
      </table>
    <% end %>

    <% if @assessables_with_assessment.empty? && @legacy_assessables.empty? %>
      <div class="text-center text-muted py-4">
        <%= @lecture.seminar? ? t('assessment.no_talks_yet') : t('assessment.no_assignments_yet') %>
      </div>
    <% end %>

    <% unless @lecture.seminar? %>
      <div class="lecture-pane-separator"></div>
      <h5 class="mb-3">
        <%= t('assessment.submission_settings') %>
      </h5>

      <%= form_with model: @lecture,
                    url: lecture_path(@lecture),
                    html: { id: 'lecture-assignments-form', class: 'mt-3' },
                    data: { turbo_frame: "_top" } do |f| %>
        <div class="row">
          <div class="col-md-6">
            <%= f.label :submission_max_team_size,
                        t('admin.lecture.submission_max_team_size'),
                        class: "form-label" %>
            <%= helpdesk t('admin.lecture.info.submission_max_team_size'), false %>
            <%= f.number_field :submission_max_team_size,
                                min: 1,
                                max: 10000,
                                class: 'form-control',
                                value: @lecture.submission_max_team_size %>
          </div>
          <div class="col-md-6">
            <%= f.label :submission_grace_period,
                        t('admin.lecture.submission_grace_period'),
                        class: "form-label" %>
            <%= helpdesk t('admin.lecture.info.submission_grace_period'), false %>
            <%= f.number_field :submission_grace_period,
                                min: 0,
                                max: 262800,
                                class: 'form-control',
                                value: @lecture.submission_grace_period %>
          </div>
        </div>
        <div class="mt-3">
          <%= hidden_field_tag :subpage, "assessments" %>
          <%= f.submit t('buttons.save'), class: "btn btn-sm btn-primary" %>
        </div>
      <% end %>
    <% end %>

    <% if @legacy_assessables.any? %>
      <div class="lecture-pane-separator"></div>
      <h5 class="mb-3">
        <%= t('assessment.legacy_items') %>
      </h5>
      <p class="text-muted small mb-3">
        <%= t('assessment.legacy_items_subtitle') %>
      </p>
      <div data-turbo="false">
        <div class="list-group">
          <% @legacy_assessables.each do |assessable| %>
            <% if assessable.is_a?(Assignment) %>
              <%= render 'assignments/row', assignment: assessable %>
            <% else %>
              <%= render AssessmentListItemComponent.new(assessable: assessable, lecture: @lecture, legacy: true) %>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>
<% end %>

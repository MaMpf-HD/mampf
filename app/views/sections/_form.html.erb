<div class="row">
  <div class="col-6">
    <h6>
      Abschnitt
      <span class="redtext">
      <%= section.to_label %>
      </span>
      bearbeiten
    </h6>
  </div>
  <div class="col-6">
    <div id="section-basics-warning"
         class="section-basics-warning"
         style="display: none;">
      Achtung, es gibt ungespeicherte Änderungen!
    </div>
  </div>
</div>
<%= form_with model: section,
              html: { id: 'section-form',
                      data: { id: section.id } } do |f| %>
  <div class="form-row">
    <div class="col-12 form-group">
      <%= f.label :title, 'Titel' %>
      <%= f.text_field :title, { class: 'form-control',
                                 id: 'section_title_' + section.id.to_s,
                                 data: { id: section.id,
                                         chapter: section.chapter.id } } %>
      <div class="invalid-feedback"
           id="section-title-error-<%= section.id %>">
      </div>
    </div>
  </div>
  <div class="form-row">
    <div class="col-12 form-group">
      <%= f.label :chapter_id,
                  'Kapitel' %>
      <%= f.select :chapter_id,
                   options_for_select(section.chapter.lecture.chapters
                                             .map { |c| [c.to_label, c.id] },
                                      section.chapter.id), {},
                   { class: 'form-control'} %>
    </div>
    <div class="col-8 form-group">
      <%= f.label :predecessor,
                  'Positionierung nach Abschnitt' %>
      <%= f.select :predecessor,
                   options_for_select([['am Anfang', 0]] +
                                      section.chapter.select_sections -
                                      [[section.to_label, section.position]],
                                      section.position - 1) ,
                                      {}, { class: 'form-control' } %>
    </div>
    <div class="col-4 form-group">
      <%= f.label :display_number,
                  'Anzeigenr.' %>
      <i class="far fa-question-circle helpdesk" 
         tabindex="0"  
         data-toggle="popover" data-trigger="focus" 
         title="Info" 
         data-content="Wird eine Anzeigenummer angegeben, so überschreibt diese die berechnete Nummer. Das macht z.B. Sinn, wenn man statt
         '§3.2. Mein Abschnitt' lieber 'Anhang A. Mein Abschnitt' als Titel haben möchte.">
      </i>
      <%= f.text_field :display_number,
                       { class: 'form-control',
                         id: 'section_number_alt_' + section.id.to_s,
                         data: { id: section.id,
                                 chapter: section.chapter.id } } %>
    </div>
  </div>
  <div class="form-group">
    <%= f.label :tag_ids, 'Verknüpfte Tags' %>
    <a class="fas fa-plus-circle clickable"
       id="new-tag-button"
       data-toggle="tooltip" title="Tag anlegen"
       data-course="<%= section.chapter.lecture.course.id %>"
       data-section="<%= section.id %>"
       data-from="section">
    </a>
    <%= f.select :tag_ids,
                 options_for_select(Tag.select_by_title,section.tag_ids),
                 {}, { multiple: true,
                       class: 'selectize mt-2',
                       data: { id: section.id,
                               chapter: section.chapter.id },
                       id: 'section_tag_ids_' + section.id.to_s } %>
    <div class="invalid-feedback"
         id="section-tags-error-<%= section.id %>">
    </div>
  </div>
  <div class="form-group">
    <%= f.label :lesson_ids, 'Sitzungen' %>
    <%= f.select :lesson_ids,
                 options_for_select(Lesson.select { |l| l.lecture == section.lecture }.sort_by(&:date).map { |l| [l.to_label, l.id] }, section.lesson_ids),
                 {}, { multiple: true,
                       class: 'selectize mt-2',
                       data: { id: section.id,
                               chapter: section.chapter.id },
                       id: 'section_lesson_ids_' + section.id.to_s } %>
    <div class="invalid-feedback"
         id="section-lessons-error-<%= section.id %>">
    </div>
  </div>
  <div class="row">
    <div class="col-12 text-center">
      <%= f.submit "Speichern", class: "btn btn-primary mr-2" %>
      <%= f.submit "Speichern und zurück", class: "btn btn-primary mr-2" %>
      <button type="button" class="btn btn-secondary" id="cancel-section">
        abbrechen
      </button>
    </div>
  </div>
<% end %>

<div class="row">
  <div class="col-6">
    <h6>
      <%= t('admin.section.edit_html',
            section: content_tag(:span, section.to_label, class: 'redtext')) %>
    </h6>
  </div>
  <div class="col-6">
    <div id="section-basics-warning"
         class="section-basics-warning"
         style="display: none;">
      <%= t('warnings.unsaved_changes') %>
    </div>
  </div>
</div>
<%= form_with model: section,
              html: { id: 'section-form',
                      data: { id: section.id } } do |f| %>
  <div class="form-row">
    <div class="col-12 form-group">
      <%= f.label :title, t('basics.title') %>
      <%= helpdesk(t('admin.section.info.title'), false) %>
      <%= f.text_field :title, { class: 'form-control',
                                 id: 'section_title_' + section.id.to_s,
                                 data: { id: section.id,
                                         chapter: section.chapter.id } } %>
      <div class="invalid-feedback"
           id="section-title-error-<%= section.id %>">
      </div>
    </div>
  </div>
  <div class="form-row">
    <div class="col-12 form-group">
      <%= f.label :chapter_id,
                  t("basics.#{section.lecture.chapter_name}") %>
      <%= helpdesk(t('admin.section.info.chapter'), false) %>
      <%= f.select :chapter_id,
                   options_for_select(lecture_chapters_for_select(section),
                                      section.chapter.id), {},
                   { class: 'form-control'} %>
    </div>
    <div class="col-8 form-group">
      <%= f.label :predecessor,
                  t('admin.section.position') %>
      <%= helpdesk(t('admin.section.info.position'), false) %>
      <%= f.select :predecessor,
                   options_for_select(section_positions_for_select(section),
                                      section.position - 1) ,
                                      {},
                                      { class: 'form-control' } %>
    </div>
    <div class="col-4 form-group">
      <%= f.label :display_number,
                  t('admin.section.display_number') %>
      <%= helpdesk(t('admin.section.info.display_number'), false) %>
      <%= f.text_field :display_number,
                       { class: 'form-control',
                         id: 'section_number_alt_' + section.id.to_s,
                         data: { id: section.id,
                                 chapter: section.chapter.id } } %>
    </div>
  </div>
  <div class="form-group">
    <%= f.label :tag_ids,
                t('basics.related_tags') %>
    <%= helpdesk(t('admin.section.info.related_tags'), false) %>
    <a class="fas fa-plus-circle clickable"
       id="new-tag-button"
       data-toggle="tooltip"
       title="Tag anlegen"
       data-course="<%= section.chapter.lecture.course.id %>"
       data-section="<%= section.id %>"
       data-from="section">
    </a>
    <%= f.select :tag_ids,
                 options_for_select(section.tags_order
                                           .map { |t| [Tag.find_by_id(t)&.extended_title, t] },
                                    section.tag_ids),
                 {},
                 { multiple: true,
                   class: 'selectize mt-2',
                   data: { id: section.id,
                           chapter: section.chapter.id,
                           ajax: true,
                           filled: false,
                           model: 'tag',
                           drag: true },
                   id: 'section_tag_ids_' + section.id.to_s } %>
    <div class="invalid-feedback"
         id="section-tags-error-<%= section.id %>">
    </div>
  </div>
  <div class="form-group">
    <%= f.label :lesson_ids,
                t('basics.lessons') %>
    <%= helpdesk(t('admin.section.info.lessons'), false) %>
    <%= f.select :lesson_ids,
                 options_for_select(section_lessons_for_select(section),
                                    section.lesson_ids),
                 {}, { multiple: true,
                       class: 'selectize mt-2',
                       data: { id: section.id,
                               chapter: section.chapter.id },
                       id: 'section_lesson_ids_' + section.id.to_s } %>
    <div class="invalid-feedback"
         id="section-lessons-error-<%= section.id %>">
    </div>
  </div>
  <div class="form-row">
    <div class="col-12">
      <div class="custom-control custom-checkbox mb-2">
        <%= f.check_box :hidden,
                        class: 'custom-control-input' %>
        <%= f.label :hidden,
                    t('admin.section.exempt'),
                    { class: 'custom-control-label' } %>
        <%= helpdesk(t('admin.section.info.exempt'), false) %>
      </div>
    </div>
  </div>
  <div class="mb-2">
    <%= t('basics.details') %>
    <%= helpdesk(t('admin.section.info.details'), false) %>
  </div>
  <%= f.trix_editor :details %>
  <div class="row mt-2 ">
    <div class="col-12 text-center">
      <%= f.submit t('buttons.save'),
                   class: "btn btn-sm btn-primary mr-2 mb-2" %>
      <%= f.submit t('buttons.save_and_exit'),
                   class: "btn btn-sm btn-primary mr-2 mb-2" %>
      <button type="button"
              class="btn btn-sm btn-secondary mb-2"
              id="cancel-section">
        <%= t('buttons.cancel') %>
      </button>
      <%= link_to t('buttons.delete'),
                  section_path,
                  method: :delete,
                  data: { confirm: 'Bist Du sicher?' },
                  class: 'btn btn-sm btn-danger mb-2' %>
    </div>
  </div>
<% end %>

<%= javascript_include_tag 'vignettes/question_type' %>
<%= form_with(
      model: [@questionnaire, @slide],
      url: @slide.new_record? ? vignettes_questionnaire_slides_path(@questionnaire) : vignettes_questionnaire_slide_path(@questionnaire, @slide),
    ) do |form| %>
  <div>
    <%= form.label :title %><br>
    <%= form.text_field :title %>
  </div>
  <div>
    <%= form.label :content %><br>
    <%= form.rich_text_area :content %>
  </div>
  <%= form.fields_for :question do |question_form| %>

    <div>
      <%= question_form.label :type, "Question Type" %>
      <%= question_form.select :type, options_for_select([
          ['No Question', ''],
          ['Text Field', 'Vignettes::TextQuestion'],
          ['Multiple Choice', 'Vignettes::MultipleChoiceQuestion']
      ], question_form.object.type), {}, { id: "question-type" } %>
    </div>
    
    <!-- The id must be the name of the corresponding class -->
    <div id="Vignettes::TextQuestion" class="question-field" style="display: none;">
      <%= question_form.label :question_text, "Question Text" %><br>
      <%= question_form.text_area :question_text, placeholder: "Enter your question here" %>
    </div>

    <div id="Vignettes::MultipleChoiceQuestion" class="question-field" style="display: none;">
      <%= question_form.label :question_text, "Question Text" %><br>
      <%= question_form.text_area :question_text, placeholder: "Enter your question here" %>

      <div>
        <%= question_form.label :options, "Options" %>
        <div id="options-container">
          <% question_form.object.options.each do |option| %>
            <div class="option-block">
              <%= question_form.fields_for :options, option do |option_form| %>
                <div class="option-field">
                  <%= option_form.text_field :text, placeholder: "Option Text" %>
                  <%= option_form.hidden_field :_destroy %>
                  <button type="button" class="remove-option">Remove</button>
                </div>
            <% end %>
            </div>
          <% end %>
          <div id="new-option-template" style="display: none;">
            <%= question_form.fields_for :options, question_form.object.options.build, child_index: "NEW_RECORD" do |option_form|%>
              <div class="option-block">
                <%= option_form.text_field :text %>
                <button type="button" class="remove-option">Remove</button>
              </div>
            <% end %>
          </div>
        </div>
        <button type="button" id="add-option">Add Option</button>
      </div>
    </div>
  <% end %>
  <div>
    <%= form.submit @slide.new_record? ? 'Create Slide' : 'Update Slide' %>
  </div>
<% end %>
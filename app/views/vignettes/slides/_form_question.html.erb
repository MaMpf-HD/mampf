<%= javascript_include_tag 'vignettes/question_type' %>

<%= form.fields_for :question do |f| %>

<!-- Question Type Selection -->
<div class="form-floating">
    <%= f.select :type,
        options_for_select([
            ['No Question', ''],
            ['Text Area', 'Vignettes::TextQuestion'],
            ['Number field', 'Vignettes::NumberQuestion'],
            ['Multiple Choice', 'Vignettes::MultipleChoiceQuestion'],
            ['Likert Scale', 'Vignettes::LikertScaleQuestion']
        ], f.object.type),
        {},
        {
            class: "form-select",
            id: "vignettes-question-type-select",
            "aria-label": "Selection for question type",
            disabled: !form.object.questionnaire.editable
        } %>
    <%= f.label :type, "Question Type" %>
</div>

<div id="vignette-question-text" class="form-floating mt-3 show">
    <%= f.text_area :question_text,
        placeholder: '_',
        class: 'form-control',
        style: 'height: 120px',
        required: f.object.question_text_required?
    %>
    <%= f.label :question_text, "Your question" %>
</div>

<div id="vignette-edit-multiple-choice" class="collapse mt-3">

    <div id="vignette-multiple-choice-options">
        <%= f.fields_for :options do |option_form| %>
            <%= render partial: "multiple_choice_fields", locals: { f: option_form, editable: form.object.questionnaire.editable } %>
        <% end %>
    </div>

    <!-- later with Stimulus: -->
    <!-- https://jonathanyeong.com/rails-stimulus-dynamic-nested-form/ -->
    <template id="vignette-multiple-choice-options-template" class="d-none">
        <%= f.fields_for :options, f.object.options.build,
                         child_index: 'NEW_RECORD' do |option_form| %>
            <%= render partial: "multiple_choice_fields", locals: { f: option_form, editable: form.object.questionnaire.editable } %>
        <% end %>
    </template>
    
    <button type="button" id="vignette-multiple-choice-add"
            class="btn btn-outline-secondary">
        <i class="bi bi-plus-circle"></i>
        Add Multiple Choice Option
    </button>
</div>

<div id="vignette-number-question-options" class="collapse mt-3">
  <div class="card">
    <div class="card-header">Number Question Settings</div>
    <div class="card-body">
      <div class="form-check mb-3">
        <%= f.check_box :only_integer, 
            class: 'form-check-input', 
            id: 'vignette-number-only-integer',
            disabled: !form.object.questionnaire.editable %>
        <%= f.label :only_integer, "Allow integers only (no decimals)", 
            class: 'form-check-label',
            for: 'vignette-number-only-integer' %>
      </div>
      
      <!-- Min/Max controls -->
      <div class="row g-3">
        <div class="col-md-6">
          <div class="form-floating">
            <%= f.number_field :min_number,
                class: 'form-control',
                id: 'vignette-number-min',
                placeholder: 'Minimum value',
                step: 'any',
                disabled: !form.object.questionnaire.editable %>
            <%= f.label :min_number, "Minimum value" %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-floating">
            <%= f.number_field :max_number,
                class: 'form-control',
                id: 'vignette-number-max',
                placeholder: 'Maximum value',
                step: 'any',
                disabled: !form.object.questionnaire.editable %>
            <%= f.label :max_number, "Maximum value" %>
          </div>
        </div>
      </div>
      
      <div class="form-text mt-2">
        Leave min/max fields empty for unlimited range
      </div>
    </div>
  </div>
</div>

<% end %>

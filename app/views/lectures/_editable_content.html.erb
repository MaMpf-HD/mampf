<div class="card bg-mdb-color-lighten-5">
  <div class="card-header">
    <div class="row">
      <div class="col-3">
        <h5>
          <%= t('lecture.content') %>
          <i id="show-media-button"
             class="far fa-list-alt clickable"
             data-toggle="tooltip"
             title="<%= t('admin.lecture.show_media') %>">
          </i>
        </h5>
      </div>
      <div class="col-2">
        <% unless inspection %>
          <%= t('admin.lecture.workflow') %>
          <%= helpdesk(t('admin.lecture.info.workflow'), true) %>
        <% end %>
      </div>
      <% unless inspection %>
        <div class="col-2">
          <span id="no-effect-warning">
            <%= t('warnings.save_before') %>
          </span>
        </div>
        <div class="col-5 text-right">
          <%= link_to t('buttons.create_chapter'),
                       new_chapter_path(lecture_id: lecture.id),
                       remote: true,
                       class: 'btn btn-secondary new-in-lecture',
                       id: 'new_chapter_button' %>
          <%= link_to t('buttons.create_lesson'),
                       new_lesson_path(lecture_id: lecture.id),
                       remote: true,
                       class: 'btn btn-secondary new-in-lecture',
                       id: 'new_lesson_button'%>
        </div>
      <% end %>
    </div>
    <% unless inspection %>
    <div class="row">
      <div class="col-12">
        <div class="custom-control custom-radio custom-control-inline">
          <input type="radio"
                 id="video-based"
                 name="content_mode"
                 <%= lecture.content_mode == 'video' ? 'checked ' : '' %>
                 class="custom-control-input content-mode"
                 data-lecture="<%= lecture.id %>">
          <label class="custom-control-label"
                 for="video-based">
            <%= t('admin.lecture.video_based') %>
          </label>
        </div>
        <div class="custom-control custom-radio custom-control-inline">
          <input type="radio"
                 id="manuscript-based"
                 name="content_mode"
                 <%= lecture.content_mode == 'manuscript' ? 'checked ' : '' %>
                 class="custom-control-input content-mode"
                 data-lecture="<%= lecture.id %>">
          <label class="custom-control-label"
                 for="manuscript-based">
            <%= t('admin.lecture.script_based') %>
          </label>
        </div>
        <%= helpdesk(t('admin.lecture.info.variants'), true) %>
      </div>
    </div>
    <% end %>
  </div>
  <div class="card-body">
    <div id="new-chapter-area"
         class="bg-green-lighten-4 p-2 mb-3 rounded">
    </div>
    <div id="new-lesson-area"
         class="bg-green-lighten-4 p-2 mb-3 rounded">
    </div>
    <% if lecture.chapters.present? %>
      <div class="card-columns">
        <% lecture.chapters.includes([:sections,:lecture]).each do |c| %>
          <div class="card <%= chapter_card_color(c) %>">
            <div id="<%= dom_id(c) %>"
                 class="card-header <%= chapter_header_color(c) %>">
              <div class="row">
                <div class="col-10">
                  <% if inspection %>
                    <span class="text-light">
                      <%= c.to_label %>
                    </span>
                  <% else %>
                    <span class="text-light">
                      <%= c.to_label %>
                    </span>
                    <a href="<%= edit_chapter_path(c) %>"
                       class="text-light"
                       data-toggle="tooltip"
                       data-placement="bottom"
                       title="<%= t('buttons.edit') %>"
                       data-remote="true">
                      <i class="far fa-edit text">
                      </i>
                    </a>
                  <% end %>
                </div>
                <% unless inspection %>
                  <div class="col-2 text-right">
                    <a href="<%= new_section_path(chapter_id: c.id) %>"
                       class="text-light new-in-lecture"
                       data-remote="true"
                       data-toggle="tooltip"
                       title="<%= t('buttons.create_section') %>">
                      <i class="fas fa-plus-circle">
                      </i>
                    </a>
                  </div>
                <% end %>
              </div>
            </div>
            <div class="card-body">
              <div id="new-section-area-<%= c.id %>"
                   class="bg-green-lighten-4 p-2 mb-3 rounded"
                   style="display: none;">
              </div>
              <ul class="list-group">
                <% c.sections.includes(:chapter, :tags).each do |s| %>
                  <li class="list-group-item <%= section_background_color(s) %>"
                      id="<%= dom_id(s) %>">
                    <div class="row">
                      <div class="col-6">
                        <strong>
                          <span class="<%= section_color(s) %>">
                          <%= s.to_label %>
                          </span>
                          <% unless inspection %>
                            <a href="<%= edit_section_path(s) %>"
                               class="text-dark"
                               data-toggle="tooltip"
                               data-placement="bottom"
                               title="<%= t('buttons.edit') %>"
                               data-remote="true"
                               style="text-decoration: none;">
                              <i class="far fa-edit">
                              </i>
                            </a>
                          <% end %>
                          <a href="<%= display_section_path(s) %>"
                               class="text-dark"
                               data-toggle="tooltip"
                               data-placement="bottom"
                               title="<%= t('buttons.content') %>"
                               data-remote="true">
                              <i class="fas fa-list-ol">
                              </i>
                          </a>
                        </strong>
                      </div>
                      <div class="col-6">
                        <% s.lessons.includes(:tags).order(:date).each do |l| %>
                          <%= link_to l.date_localized,
                                      lesson_link(l, inspection),
                                      class: 'badge badge-secondary' +
                                             ' lecture-lesson',
                                      id: 'lecture-' + dom_id(l),
                                      remote: true,
                                      data: { id: l.id,
                                              tags: l.tags.map(&:id) } %>
                        <% end %>
                      </div>
                      <% unless s.details.blank? %>
                        <div class="col-12 my-2">
                          <div class="bg-mdb-color-lighten-8 rounded p-2">
                            <%= s.details.html_safe %>
                          </div>
                        </div>
                      <% end %>
                      <div class="col-12 mt-2">
                        <% s.ordered_tags.each do |t| %>
                          <%= link_to shorten(t.title, 45),
                                      edit_tag_path(t),
                                      id: 'lecture-' + dom_id(t),
                                      class: 'badge badge-light lecture-tag',
                                      title: (t.title if t.title.length > 45),
                                      data: { id: t.id,
                                              lessons: t.lessons.map(&:id),
                                              toggle: 'tooltip',
                                              placement: 'bottom' } %>
                        <% end %>
                      </div>
                    </div>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <%= t('admin.lecture.no_chapters') %>
    <% end %>
    <% if lecture.orphaned_lessons.present? %>
      <%= t('admin.lecture.orphaned_lessons') %>:
      <%= helpdesk(t('admin.lecture.info.orphaned_lessons'), false) %>
      <% lecture.orphaned_lessons.each do |l| %>
        <%= link_to  l.date_localized,
                     edit_lesson_path(l),
                     remote: true,
                     class: 'badge badge-light' %>
      <% end %>
    <% end %>
  </div>
</div>

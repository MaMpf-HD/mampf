<div class="card bg-mdb-color-lighten-5">
  <div class="card-header">
    <div class="row">
      <div class="col-3">
        <h5>
          Vorlesungsinhalt
          <i id="show-media-button"
             class="far fa-list-alt clickable"
             data-toggle="tooltip"
             title="Medien einblenden">
          </i>
        </h5>
      </div>
      <div class="col-2">
        <% unless inspection %>
        zum Workflow
          <i class="far fa-question-circle helpdesk"
             tabindex="-1"
             data-toggle="popover" data-trigger="focus"
             title="Info"
             data-content="Der ideale Workflow sieht so aus, dass man zunächst
             Kapitel und Abschnitte anlegt und diese tagged. Danach werden
             Sitzungen und zugeordnete Medien angelegt, diese erben dann
             die entsprechenden Tags. Andersherum geht es natürlich auch,
             dann ist jedoch ein höherer Aufwand beim Tagging erforderlich.">
          </i>
        <% end %>
      </div>
      <% unless inspection %>
        <div class="col-2">
          <span id="no-effect-warning">
            Du musst zunächst die anderen Änderungen speichern oder verwerfen.
          </span>
        </div>
        <div class="col-5 text-right">
          <%= link_to 'Kapitel anlegen',
                       new_chapter_path(lecture_id: lecture.id),
                       remote: true,
                       class: 'btn btn-secondary new-in-lecture',
                       id: 'new_chapter_button' %>
          <%= link_to 'Sitzung anlegen',
                       new_lesson_path(lecture_id: lecture.id),
                       remote: true,
                       class: 'btn btn-secondary new-in-lecture',
                       id: 'new_lesson_button'%>
        </div>
      <% end %>
    </div>
  </div>
  <div class="card-body">
    <div id="new-chapter-area"
         class="bg-green-lighten-4 p-2 mb-3 rounded">
    </div>
    <div id="new-lesson-area"
         class="bg-green-lighten-4 p-2 mb-3 rounded">
    </div>
    <% if lecture.chapters.present? %>
      <div class="card-columns">
        <% lecture.chapters.includes([:sections,:lecture]).each do |c| %>
          <div class="card bg-mdb-color-lighten-5">
            <div id="<%= dom_id(c) %>"
                 class="card-header bg-mdb-color-lighten-2">
              <div class="row">
                <div class="col-6">
                  <% if inspection %>
                    <span class="text-light">
                      <%= c.to_label %>
                    </span>
                  <% else %>
                    <span class="text-light">
                      <%= c.to_label %>
                    </span>
                    <a href="<%= edit_chapter_path(c) %>"
                       class="text-light"
                       data-toggle="tooltip"
                       data-placement="bottom"
                       title="Bearbeiten"
                       data-remote="true">
                      <i class="far fa-edit">
                      </i>
                    </a>
                  <% end %>
                </div>
                <% unless inspection %>
                  <div class="col-6 text-right">
                    <a href="<%= new_section_path(chapter_id: c.id) %>"
                       class="text-light new-in-lecture"
                       data-remote="true"
                       data-toggle="tooltip" title="Abschnitt anlegen">
                      <i class="fas fa-plus-circle">
                      </i>
                    </a>
                  </div>
                <% end %>
              </div>
            </div>
            <div class="card-body">
              <div id="new-section-area-<%= c.id %>"
                   class="bg-green-lighten-4 p-2 mb-3 rounded"
                   style="display: none;">
              </div>
              <ul class="list-group">
                <% c.sections.includes(:chapter, :tags).each do |s| %>
                  <li class="list-group-item bg-mdb-color-lighten-6"
                      id="<%= dom_id(s) %>">
                    <div class="row">
                      <div class="col-6">
                        <strong>
                          <% if inspection %>
                            <%= s.to_label %>
                          <% else %>
                            <%= s.to_label %>
                            <a href="<%= edit_section_path(s) %>"
                               class="text-dark"
                               data-toggle="tooltip"
                               data-placement="bottom"
                               title="Bearbeiten"
                               data-remote="true">
                              <i class="far fa-edit">
                              </i>
                            </a>
                          <% end %>
                        </strong>
                      </div>
                      <div class="col-6">
                        <% s.lessons.includes(:tags).order(:date).each do |l| %>
                          <%= link_to l.date_de,
                                      lesson_link(l, inspection),
                                      class: 'badge badge-secondary' +
                                             ' lecture-lesson',
                                      id: 'lecture-' + dom_id(l),
                                      remote: true,
                                      data: { id: l.id,
                                              tags: l.tags.map(&:id) } %>
                        <% end %>
                      </div>
                      <div class="col-12 mt-2">
                        <% s.tags.includes(:lessons).each do |t| %>
                          <%= link_to shorten(t.title, 45),
                                      tag_link(t, inspection),
                                      id: 'lecture-' + dom_id(t),
                                      class: 'badge badge-light lecture-tag',
                                      title: (t.title if t.title.length > 45),
                                      data: { id: t.id,
                                              lessons: t.lessons.map(&:id),
                                              toggle: 'tooltip',
                                              placement: 'bottom' } %>
                        <% end %>
                      </div>
                    </div>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      Es sind noch keine Kapitel vorhanden.
    <% end %>
    <% if lecture.orphaned_lessons.present? %>
      Verwaiste Sitzungen:
      <% lecture.orphaned_lessons.each do |l| %>
        <%= link_to  l.date_de,
                     edit_lesson_path(l),
                     remote: true,
                     class: 'badge badge-light' %>
      <% end %>
    <% end %>
  </div>
</div>

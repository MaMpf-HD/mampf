<div class="card-header">
  <div class="row">
    <div class="col-12">
      <h5>
        Basisdaten
      </h5>
    </div>
  </div>
</div>
<div class="card-body p-2">
  <div class="form-group">
    <%= f.label :title, 'Titel' %>
    <%= f.text_field :title, { class: 'form-control',
                               data: { id: tag.id.to_i },
                               id: 'tag_title_' + tag.id.to_i.to_s } %>
    <div class="invalid-feedback" id="tag-title-error-<%= tag.id.to_i %>">
    </div>
  </div>
  <div class="form-group">
    <%= f.label :related_tag_ids, 'Verknüpfte Tags' %>
    <%= f.select :related_tag_ids,
                 options_for_select(Tag.where.not(id: tag.id)
                                       .map { |t| [t.title, t.id]},
                                    tag.related_tag_ids),
                 {}, { multiple: true,
                       class: 'selectize',
                       data: { id: tag.id.to_i } } %>
    <% unless new_tag %>
      <button type="button" class="btn btn-sm btn-outline-secondary"
              id="new-tag-button" data-tag="<%= tag.id %>" data-from="tag">
        Tag anlegen
      </button>
    <% end %>
    <div class="invalid-feedback"
         id="tag-related-tags-error-<%= tag.id.to_i %>">
    </div>
  </div>
  <div class="form-group">
    <%= f.label :course_ids, 'Module' %>
    <%= f.select :course_ids,
                 options_for_select(Course.all.map { |t| [t.title, t.id ]},
                                    tag.course_ids),
                 {}, { multiple: true,
                       class: 'selectize',
                       data: { id: tag.id.to_i } } %>
    <div class="invalid-feedback" id="tag-courses-error-<%= tag.id.to_i %>">
    </div>
  </div>
  <% unless new_tag %>
  <% if tag.extra_lectures.present? %>
  <div class="row">
    <div class="col-12">
      Zusätzliche Vorlesungen
    </div>
    <div class="col-12">
      <ul>
        <% tag.extra_lectures.each do |l| %>
          <li>
            <%= link_to l.title, inspect_lecture_path(l) %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
  <% end %>
  <% if tag.missing_lectures.present? %>
  <div class="row">
    <div class="col-12">
      Fehlende Vorlesungen
    </div>
    <div class="col-12">
      <ul>
        <% tag.missing_lectures.each do |l| %>
          <li>
            <%= link_to l.title, inspect_lecture_path(l) %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
  <% end %>
  <% end %>
  <% if from == 'section' %>
    <%= f.hidden_field :section_id, value: tag.section_ids.first %>
  <% end %>
  <% if from == 'medium' %>
    <%= f.hidden_field :medium_id, value: tag.medium_ids.first %>
    <% medium = Medium.find_by_id(tag.medium_ids.first) %>
    <% if medium.present? && medium.teachable.class.to_s != 'Course' %>
      <% section_selection = medium.teachable.lecture.section_selection %>
      <% if medium.teachable.class.to_s == 'Lecture' %>
        <% preselected_sections = [] %>
      <% else %>
        <% preselected_sections = medium.teachable.sections.map(&:id) %>
      <% end %>
      <div class="form-group">
        <%= f.label :section_ids, 'Abschnitte' %>
        <%= f.select :section_ids,
                 options_for_select(section_selection, preselected_sections),
                 {}, { multiple: true,
                       class: 'selectize'} %>
      </div>
    <% end %>
  <% end %>
</div>

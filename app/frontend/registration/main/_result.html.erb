<div class="row g-3">

  <% if item_succeed %>
    <!-- SUCCESS CASE -->
    <div class="d-flex flex-column gap-3">

      <!-- Assignment + Capacity -->
      <div class="row g-3 justify-content-between">

        <!-- Assignment card -->
        <div class="col-12 col-lg-8">
          <div class="card">
            <div class="card-body">

              <div class="h5">
                <%= t("registration.confirmed_assignment_pref", type: item_succeed.registerable_type) %>
              </div>

              <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-2">

                <div>
                  <div class="text-muted small">
                    <%= item_succeed.registerable_type %>:
                  </div>

                  <div class="fs-1 fw-semibold text-primary">
                    <%= item_succeed.try(:time) || item_succeed.try(:title) %>
                  </div>

                  <div class="text-muted small">
                    <% if item_succeed.try(:room).present? %>
                      <%= t("basics.room") %>: <%= item_succeed.room %><br>
                    <% end %>

                    <% if item_succeed.registerable.try(:tutors).present? %>
                      <%= t("basics.tutor") %>:
                      <%= item_succeed.registerable.tutors.map { |e|
                            link_to "#{e.name_in_tutorials.presence || e.name} (#{e.email})", teacher_path(e)
                          }.join(", ").html_safe %><br>
                    <% end %>

                    <% if item_succeed.registerable.try(:speakers).present? %>
                      <%= t("basics.speaker") %>:
                      <%= item_succeed.registerable.speakers.map { |e|
                            link_to "#{e.name_in_tutorials.presence || e.name} (#{e.email})", teacher_path(e)
                          }.join(", ").html_safe %><br>
                    <% end %>

                    <% if item_succeed.registerable.try(:position).present? %>
                      <%= t("basics.position") %>: <%= item_succeed.registerable.position %>
                    <% end %>
                  </div>
                </div>

                <span class="badge rounded-pill text-bg-success mt-2 mt-md-0">
                  <%= t("basics.confirmed") %>
                </span>

              </div>
            </div>
          </div>
        </div>

        <!-- Capacity card -->
        <div class="col-12 col-lg-4">
          <div class="card">
            <div class="card-body">
              <div class="row g-2">
                <div class="col-6 col-md-3">
                  <div class="small text-muted"><%= t("basics.capacity") %></div>
                  <div class="fw-semibold">
                    <%= item_succeed.item_capacity_used %> /
                    <%= nullable_capacity_display(item_succeed.capacity) %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- Submitted preferences -->
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="h6"><%= t("registration.submitted_pref") %></div>
            <ol class="small mb-0">
              <% items_selected.each do |item| %>
                <li class="mb-2">
                  <div class="row">
                    <div class="col-9 row">
                      <div class="col-4 d-flex gap-1">
                        <span class="fw-medium"><%= t("registration.item.columns.type") %>:</span>
                        <span class="fw-normal"><%= item_display_type(item) %></span>
                      </div>
                      <div class="col-4 d-flex gap-1">
                        <span class="fw-medium"><%= t("registration.item.columns.title") %>:</span>
                        <span class="fw-normal"><%= item.title %></span>
                      </div>
                      <div class="col-4 d-flex gap-1">
                        <span class="fw-medium"><%= t("basics.seats") %>:</span>
                        <span class="fw-normal"><%= nullable_capacity_display(item.capacity) %></span>
                      </div>
                    </div>
                    <div class="col-3 d-flex justify-content-end align-items-center">
                      <%= confirm_status_badge(status_items_selected[item.id]) %>
                    </div>
                  </div>
                </li>
              <% end %>
            </ol>
          </div>
        </div>
      </div>
    </div>

  <% else %>
    <!-- FAILURE CASE -->

    <div class="col-12 col-lg-8">
      <div class="card">
        <div class="card-body">
          <div class="alert alert-danger py-1 px-2">
            <%= t("registration.messages.cannot_secure_slot") %>
          </div>
          <div class="h6"><%= t("registration.status_for_registration") %></div>
          
          <table class="table align-middle mb-2">
            <thead>
              <tr>
                <th class="fw-semibold"><%= t("registration.item.columns.type") %></th>
                <th class="fw-semibold"><%= t("registration.item.columns.title") %></th>
                <th class="fw-semibold">Attribute</th>
                <th class="fw-semibold text-end"><%= t("basics.status") %></th>
              </tr>
            </thead>
            <tbody>
              <% items_selected.each do |item| %>
                <tr>
                  <td class="small text-dark">
                    <%= item_display_type(item) %>
                  </td>
                  <td class="small text-dark">
                    <%= item.registerable.title %>
                  </td>
                  <td class="small text-dark">
                    <% Registration::UserRegistrationsHelper::TABLE_CONFIG[item.registerable_type].each do |col| %>
                      <div class="d-flex gap-1">
                        <span class="fw-medium small"><%= col[:header] %>:</span>
                        <span class="fw-normal small"><%= col[:field].call(item) %></span>
                      </div>
                    <% end %>
                  </td>
                  <td class="text-end">
                    <%= confirm_status_badge(status_items_selected[item.id]) %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>

        </div>
      </div>
    </div>

    <div class="col-12 col-lg-4">
      <div class="card">
        <div class="card-body">
          <%= t("registration.messages.course_admin_help") %>
        </div>
      </div>
    </div>

  <% end %>

</div>

<% campaign = component.active_campaign_for(item) %>
<div class="col">
  <div class="card h-100 roster-tile rounded-3 <%= 'cohort' if group[:type] == :cohorts %>">
    <div class="card-body d-flex flex-column">

      <%# HEADER: Title & Status %>
      <div class="d-flex justify-content-between align-items-start mb-2">
        <h6 class="card-title fw-bold mb-0 text-truncate" title="<%= item.title %>">
          <%= item.title %>
        </h6>
        <%= render "roster/components/groups_tab/status_cell", item: item, campaign: campaign, component: component %>
      </div>

      <%# BODY: Description / Tutors %>
      <div class="small text-muted mb-3 flex-grow-1">
        <% if group[:type] == :tutorials %>
          <i class="bi bi-person me-1"></i>
          <%= item.tutor_names.presence || "TBA" %>
        <% elsif group[:type] == :cohorts %>
          <% if item.description.present? %>
            <div class="text-truncate-3" title="<%= item.description %>">
              <%= item.description %>
            </div>
          <% end %>
        <% elsif group[:type] == :talks %>
           <% if item.dates.present? %>
            <div><%= format_talk_dates(item.dates) %></div>
           <% end %>
           <% if item.respond_to?(:speakers) && item.speakers.any? %>
            <div><%= item.speakers.map(&:name).join(", ") %></div>
           <% end %>
        <% end %>
      </div>

      <%# FOOTER: Utilization %>
      <div class="mt-auto">
        <% if item.capacity %>
          <% current_count = item.roster_entries.count %>
          <% overbooked = current_count > item.capacity %>
          <div class="d-flex justify-content-between font-monospace small mb-1">
            <span><%= t('roster.columns.occupancy') %></span>
            <span class="<%= 'text-danger fw-bold' if overbooked %>">
              <%= current_count %> / <%= item.capacity %>
              <% if overbooked %>
                <i class="bi bi-exclamation-triangle-fill text-danger"></i>
              <% end %>
            </span>
          </div>
          <%= progress_bar(current_count, item.capacity, classification: :utilization, height: "6px", show_label: false, container_class: "progress") %>
        <% else %>
          <%# Unlimited capacity %>
          <div class="d-flex justify-content-between font-monospace small mb-1">
            <span><%= t('roster.columns.occupancy') %></span>
            <span><%= item.roster_entries.count %> / &infin;</span>
          </div>
          <div class="progress" style="height: 6px;">
            <div class="progress-bar bg-success" role="progressbar" style="width: 5%"></div>
          </div>
        <% end %>
      </div>

      <%# ACTIONS OVERLAY %>
      <div class="tile-actions mt-3 pt-2 border-top d-flex justify-content-end gap-1">
        <%= render "roster/components/groups_tab/item_actions",
                   item: item,
                   campaign: campaign,
                   component: component,
                   group_type: group_type %>
      </div>
    </div>
  </div>
</div>
